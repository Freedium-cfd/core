<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title></title>
	
    <meta name="description" content="Your paywall breakthrough for medium.com!" />
    <meta name="keywords" content="medium, paywall, medium.com, paywall breakthrough" />
    <link rel="stylesheet" href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css"/>
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#00aba9">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">
    <script src="https://cdn.jsdelivr.net/npm/lightense-images@1.0.17/dist/lightense.min.js"></script>
  </head>

<body class="bg-gray-100 font-sans leading-normal tracking-normal">
	<nav id="header" class="fixed w-full z-10 top-0">
	

		<div id="progress" class="h-1 z-20 top-0" style="background:linear-gradient(to right, #4dc0b5 var(--scroll), transparent 0);"></div>

		<div class="w-full md:max-w-4xl mx-auto flex flex-wrap items-center justify-between mt-0 py-3">

			<div class="pl-4">
				<a class="text-green-500 text-base no-underline hover:no-underline font-extrabold text-xl" href="/" onclick="navigateToOrigin()">
					Freedium βeta
				</a>
			</div>

			<div class="block lg:hidden pr-4">
				<button id="nav-toggle" class="flex items-center px-3 py-2 border rounded text-gray-500 border-gray-600 hover:text-gray-900 hover:border-green-500 appearance-none focus:outline-none">
					<svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
						<title>Menu</title>
						<path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" />
					</svg>
				</button>
			</div>

			<div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block mt-2 lg:mt-0 bg-gray-100 z-20" id="nav-content">
				<ul class="list-reset lg:flex justify-end flex-1 items-center">
					<!--
					<li class="mr-3">
						<a class="inline-block py-2 px-4 text-gray-900 font-bold no-underline" href="#">Active</a>
					</li>
					-->
					<li class="mr-3">
						<a class="inline-block text-gray-600 no-underline hover:text-gray-900 hover:text-underline py-2 px-4" href="https://medium.com/">Medium.com</a>
					</li>
					<!--
					<li class="mr-3">
						<a class="inline-block text-gray-600 no-underline hover:text-gray-900 hover:text-underline py-2 px-4" href="#">link</a>
					</li>
				-->
				</ul>
			</div>
		</div>
	</nav>



<div class="container w-full md:max-w-3xl mx-auto pt-20 break-words">

		<div class="w-full px-4 md:px-6 text-xl text-gray-800 leading-normal" style="font-family:Georgia,serif;">

			<div class="font-sans">
				<p class="text-base md:text-sm text-green-500 font-bold pb-3"><a href="https://medium.com/@jogarcia/breaking-the-proxy-walls-with-redsocks-in-linux-f4c1bfb6fb6a" class="text-sm md:text-sm text-green-500 font-bold no-underline hover:underline ">&lt; Go to the original</a></p>
                
                <img alt="Preview image" style="max-height: 65vh;width: auto;margin: auto;" loading="eager" role="presentation" src="https://miro.medium.com/v2/resize:fit:700/1*GTkU0Vq0Lwja_gWpLDZaBw.jpeg">
                
				<h1 class="font-bold font-sans break-normal text-gray-900 pt-6 pb-2 text-3xl md:text-4xl">Breaking the proxy walls with Redsocks in Linux</h1>
                
                <h2 class="font-medium font-sans break-normal text-gray-600 pt-1 pb-3 text-1xl md:text-1xl">A guide on how to configure a global proxy in Linux with Redsocks</h2>
                
			</div>

			<div class="bg-gray-100 border border-gray-300 m-2">
  <div class="flex items-center space-x-4 p-4">
    <div class="flex-shrink-0">
      <a href="https://medium.com/@jogarcia" target="_blank" title="Hello There! I am a fullstack developer, a fan of open source and crypto and an obssesive fella. Well met." class="block relative">
        <img src="https://miro.medium.com/v2/resize:fill:88:88/1*CnLBjwI8NBbus2SI7s7sgQ.jpeg" alt="Jose Garcia" class="rounded-full h-11 w-11 no-lightense">
        <div class="absolute bottom-0 right-0 h-3 w-3 border-2 border-white bg-green-500 rounded-full"></div>
      </a>
    </div>
    <div class="flex-grow">
      <a href="https://medium.com/@jogarcia" target="_blank" title="Hello There! I am a fullstack developer, a fan of open source and crypto and an obssesive fella. Well met." class="block font-semibold text-gray-900">Jose Garcia</a>
      <button class="text-sm text-white bg-green-500 px-3 py-1 rounded-lg mt-1"><a href="https://medium.com/@jogarcia" target="_blank" title="Hello There! I am a fullstack developer, a fan of open source and crypto and an obssesive fella. Well met." class="block text-sm text-white">Follow</a></button>
    </div>
  </div>
  <div class="px-4 pb-2">
    <div class="flex flex-wrap items-center space-x-2 text-sm text-gray-500">
      
      <span class="text-gray-500">~5 min read</span>
      <span class="md:inline">·</span>
      <span class="text-gray-500">October 11, 2022 (Updated: October 11, 2022)</span>
	  <span class="md:inline">·</span>
	  <span class="text-yellow-500">Free: Yes</span>

    </div>
  </div>
</div>


	<p class="mt-7">Are you one of those unfortunate souls behind a corporate proxy? I was one of you, my brothers. In this article, I will show you how to infiltrate that pesky proxy that has been giving you headaches with Redsocks (not the baseball team).</p>

	<p class="mt-7">The objective of this tutorial is to show you how to proxify your entire computer connection.</p>

	<p class="mt-7">This tutorial is divided into two parts:</p>

	<ol class="list-decimal pl-8 mt-2"><li>Redsocks. Software to be used to proxify your computer’s entire connection.</li><li>Iptables. Redirects all traffic thru Redsocks.</li></ol>

	<p class="mt-7">You need both to get this done. Redsocks is a software that sits between your computer and the proxy (it lives in your computer). The software doesn’t control the traffic flow unless you manually give it to it to be handled. And to do that we are going to be using iptables.</p>

	<p class="mt-7">Notes:</p>

	<ul class="list-disc pl-8 mt-2"><li>The install command I am going to write about in Linux is going to be for Debian-based distros.</li></ul>

	<p class="mt-7">Disclaimer:</p>

	<ul class="list-disc pl-8 mt-2"><li>You may be doing something illegal by doing this. Ask away about your company’s policies concerning their proxy. I do not condone illegal activities.</li></ul>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">What is Redsocks?</h1>

	<p class="mt-3">Redsocks is a software tool that allows you to redirect all connections leaving and entering your computer.</p>

	<p class="mt-7">Where too? Anywhere.</p>

	<p class="mt-7">Redsocks is a service that lives in your machine. It mediates between your computer and the proxy.</p>

	<p class="mt-7">It is not included on your distro though. So, let’s install it.</p>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">Installing Redsocks</h1>

	<p class="mt-3">This part is always a little tricky. If you are here trying to bypass a proxy it means that your computer doesn’t have internet access. Even so, the way to install Redsocks is by using your distro’s package manager.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">sudo apt install redsocks</span></pre>

	<p class="mt-7">So you are going to have to get a little creative. My suggestion is tethering with your phone.</p>

	<p class="mt-7">Also in case you want to take a look at the code or check the documentation of Redsocks takes a look at their repo:</p>

	<p class="mt-7">Let’s configure it.</p>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">Redsocks configuration</h1>

	<p class="mt-3">Create the redsocks config file (by copying from here). The file should be named redsocks.conf. Make sure to name it correctly.</p>

	<p class="mt-7">Now, this is quite long so let me explain briefly what each part does.</p>

	<p class="mt-7">Inside base, the first three lines activate the logs. Logging allows you to check if errors occurred connecting.</p>

	<p class="mt-7">Logging is optional but very recommended.</p>

	<p class="mt-7">The next two lines activate logging.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">log_debug = on; <br />log_info = on;</span></pre>

	<p class="mt-7">The next snippet is were you can define the location of the log file.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">log = &quot;file:/var/log/redsocks.log&quot;;</span></pre>

	<p class="mt-7">Runs redsocks as a service.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">daemon = on;</span></pre>

	<p class="mt-7">Tells Redsocks about the redirector type. In this case it uses iptables to redirect the traffic your computer’s traffic.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">redirector = iptables;</span></pre>

	<p class="mt-7">About the redsocks option. You can have multiple of them. How much? As many as you need. Since what we want is to give access to the internet to our entire machine we are going to be using one for HTTPS and one for HTTP traffic. As they have the same options let’s go line by line.</p>

	<p class="mt-7">The next line configures the service to listen on every interface.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">local_ip = 0.0.0.0;</span></pre>

	<p class="mt-7">The port I am opening on the computer to redirect the traffic thru.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">local_port = 12345;</span></pre>

	<p class="mt-7">Notice that I have a different port opened in each redsocks config object.</p>

	<p class="mt-7">You can open many as you like (as long as it doesn’t conflict with the reserved opened ports). If you don’t know what I am talking about leave my port. It should work just fine.</p>

	<p class="mt-7">The ip (url in this case, both are good) and port of the corporate proxy.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">ip = proxy.uclv.cu;<br />port = 3128;</span></pre>

	<p class="mt-7">The connection type that the corporate proxy allows. Usually http-connect or http-relay.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">// Types: socks4, socks5, http-connect, http-relay<br />type = http-relay;</span></pre>

	<p class="mt-7">There is no easy way of know which type you will have to use. In my case http-connect for the https connections and http-relay for http connection. But by all means it won’t be necessarily the same for you. If you want to know the difference take a look at this issue:</p>

	<p class="mt-7">The next step is optional. If the proxy in your company requires an user you can use these options.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">login = &quot;proxyUser&quot;;<br />password = &quot;proxyPassword&quot;;</span></pre>

	<p class="mt-7">After creating the file with all the configurations, copy it to /etc/redsocks.con.</p>

	<p class="mt-7">And with that Redsocks is covered. Now to the iptables</p>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">What are the iptables?</h1>

	<p class="mt-3">The Iptables software is a utility that allows you to control the traffic flow of the internet in your computer. That’s oversimplifying it though. Take a look at this if you want to know more about it.</p>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">Installing Iptables</h1>

	<p class="mt-3">Already installed in Linux. Nothing to do here my good man.</p>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">Iptables configuration</h1>

	<p class="mt-3">Am going to create a .sh file to facilitate the process. Notice that everything in that file you could do by throwing commands in the terminal.</p>

	<p class="mt-7">Again, a lot is going on here. And though almost every line of code is commented let’s go over it even so.</p>

	<p class="mt-7">First, we create a new chain by doing:</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">iptables -t nat -N REDSOCKS</span></pre>

	<p class="mt-7">Later on, we need to ignore LAN and reserved IPs by doing:</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">iptables -t nat -A REDSOCKS -d 0.0.0.0/8 -j RETURN                             iptables -t nat -A REDSOCKS -d 10.0.0.0/8 -j RETURN                             iptables -t nat -A REDSOCKS -d 100.64.0.0/10 -j RETURN                             iptables -t nat -A REDSOCKS -d 127.0.0.0/8 -j RETURN                             iptables -t nat -A REDSOCKS -d 169.254.0.0/16 -j RETURN                             iptables -t nat -A REDSOCKS -d 172.16.0.0/12 -j RETURN                             iptables -t nat -A REDSOCKS -d 192.168.0.0/16 -j RETURN                             iptables -t nat -A REDSOCKS -d 198.18.0.0/15 -j RETURN                             iptables -t nat -A REDSOCKS -d 224.0.0.0/4 -j RETURN                             iptables -t nat -A REDSOCKS -d 240.0.0.0/4 -j RETURN</span></pre>

	<p class="mt-7">Now we need to redirect the rest of the traffic</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">iptables -t nat -A REDSOCKS -p tcp --dport 80 -j REDIRECT --to-ports 12346                             <br />iptables -t nat -A REDSOCKS -p tcp --dport 443 -j REDIRECT --to-ports 12345                             </span></pre>

	<p class="mt-7">Am redirecting all HTTP traffic thru 12346 and all HTTPS traffic to 12345. The ports I opened with Redsocks.</p>

	<p class="mt-7">The next one is a little truculent.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">iptables -t nat -A REDSOCKS -p tcp -j REDIRECT --to-ports 12345</span></pre>

	<p class="mt-7">This redirects everything that enters the REDSOCKS chain to the 12345 port.</p>

	<p class="mt-7">Finally.</p>

	<pre class="p-4 mt-7"><span style="word-break: break-word; white-space: pre-wrap;">iptables -t nat -A OUTPUT -p tcp -j REDSOCKS</span></pre>

	<p class="mt-7">Redirect every connection leaving your machine to the REDSOCKS chain to be handled there.</p>

	<h1 class="font-bold font-sans break-normal text-gray-900 pt-5 text-1xl md:text-2xl">Conclusions</h1>

	<ul class="list-disc pl-8 mt-2"><li>Bypassing a proxy is a little complicated… Unless you are a hardcore hacker.</li><li>You need both Redsocks and iptables to bypass the proxy.</li><li>Redsocks allows you to globally proxify your computer.</li><li>You need iptables to redirect all of your traffic throughout Redsocks’ service.</li></ul>

	<p class="mt-7">I spent weeks finding out a utility to help me do this. The OS&#39 native proxy didn’t work for me at all. I hope that with this article you don’t waste the same time I did. Good luck with that proxy brother in the force.</p>


	<div class="flex flex-wrap gap-2 mt-5">
		
        <a title="Linux" target="_blank" href="https://medium.com/tag/linux"><span class="text-green-500 bg-green-100 px-2 py-1 rounded-full text-xs">#linux</span></a>
    
        <a title="Proxy" target="_blank" href="https://medium.com/tag/proxy"><span class="text-green-500 bg-green-100 px-2 py-1 rounded-full text-xs">#proxy</span></a>
    
  </div>

<div class="container w-full md:max-w-3xl mx-auto pt-12"></div>

</div>

<style>
code {
    /*font-size: 75%;*/
    background-color: #e3e2e2;
}
pre {
    font-size: 75%;
    background-color: #e3e2e2;
}
</style>
<script>
  function navigateToOrigin() {
    window.location.href = window.location.origin;
  }
</script>

<script>
const h = document.documentElement, b = document.body;
const st = 'scrollTop';
const sh = 'scrollHeight';
const progress = document.getElementById('progress');
const header = document.getElementById('header');
const navcontent = document.getElementById('nav-content');

document.addEventListener('scroll', function () {
  /* Refresh scroll % width */
  const scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
  progress.style.setProperty('--scroll', scroll + '%');

  /* Apply classes for slide in bar */
  const shouldAddClass = window.scrollY > 10;

  header.classList.toggle('bg-white', shouldAddClass);
  header.classList.toggle('shadow', shouldAddClass);
  navcontent.classList.toggle('bg-gray-100', !shouldAddClass);
  navcontent.classList.toggle('bg-white', shouldAddClass);
});

		document.getElementById('nav-toggle').onclick = function() {
			document.getElementById("nav-content").classList.toggle("hidden");
		}

  window.addEventListener('load', function () {
       Lightense('img:not(.no-lightense)');
  }, false);
</script>
</body>

</html>